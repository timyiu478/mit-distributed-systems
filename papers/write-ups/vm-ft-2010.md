---
title: The Design of Practical System for Fault-Tolerance Virtual Machine
description:
tags: ["Fault-Tolerance", "Backup"]
reference: https://pdos.csail.mit.edu/6.824/papers/vm-ft.pdf
---

## Key Contributions

* Bressoud and Schneider [3] describe a prototype implementation of fault-tolerant VMs for the HP PA-RISC platform. 
* They have made some fundamental changes for **performance reasons** and investigated a number of **design alternatives**. 
    * efficient event delivery mechanism
* In addition, we have had to design and implement many additional components in the system and deal with a number of **practical issues** to build a complete system that is efficient and usable by customers running enterprise applications.

## Basic Fault-Tolerance Design

![](assets/basic_ft_design.png)

## Deterministic Replay Implementation

* Deterministic replay records the inputs of a VM and all possible non-determinism associated with the VM execution in a stream of log entries written to a log file.
* For non-deterministic operations, sufficient information is logged to allow the operation to be reproduced with the same state change and output. During replay, the event is delivered at the same point in the instruction stream.


## Questions


Q. What is the failure mode the system target to deal with?

* Fail-Stop: failure be detected before the failing server causes an incorrect externally visible action


Q. What are the ways of replicating states to backup machine?

* replicate all states (CPU, Memory, I/O devices)
    * cons: need high bandwidth for transfering states from primary to backup
* Sate Machine Approach(Replicate Computation)
    * keep them in sync by letting them receiving the same inputs with same order
    * pros: need less bandwidth, ideal for deterministic state transition and the information for state transition is less than the information for memory update
    * cons: need a way to handle non-deterministic operations (e.g. reading a time of the clock, I/O Interrupt events)


Q. Why is SMR approach suitable for VM?

* VM can be considered as a state machine where all its operation are being virtualized => The hypervisor can capture all non-deterministic operations from the primary and replay them correctly to the backup.
* better physical seperation => primary and backup can run on different physical machine


Q. Whare are the challenges of replicating execution of any VM running any operating system and workload?

1. correctly capturing all the input and non-determinism necessary to ensure deterministic execution of a backup virtual machine
1. correctly applying the inputs and nondeterminism to the backup virtual machine
1. doing in a manner that does not degrade performance

Q. The paper says FT doesn't cope with multi-processor guests. Why not?

In general, the results of software running on multiple processors depends on exactly how the **instruction streams on the processors were interleaved**. For FT to ensure that the backup stays in sync with the primary, it would have to cause the interleaving to be the same on both computers. This turns out to be hard: you can't easily find out what the interleaving is on the primary, and you can't easily control it on either machine.


Q. How does VM FT handle network partitions? That is, is it possible that if the primary and the backup end up in different network partitions that the backup will become a primary too and the system will run with two primaries?


Q. what I find most confusing about the paper?
